<html>

<head>
	<script src="js/jquery.js"></script>
	<script src="js/jquery-ui-1.10.4.min.js"></script>
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/jquery-ui-1.10.4.css">
</head>

<style type="text/css">
table{
	margin: 40px 0px 0px 40px;
}

div.icon{
	width: 65px;
	height: 65px;
}
div.icon1{
	background-color: #FCC;
	text-align: center;
	border: ridge;
}
div.icon2{
	background-color: #CFC;
	text-align: center;
	border: ridge;
}
div.icon3{
	background-color: #CCF;
	text-align: center;
	border: ridge;
}

div.frame{
	width: 80px;
	height: 80px;
	background-color: #EEE;
	text-align: center;
}



.slot{
	width: 60px;
	text-align: center;
}

.aircraft{
}

.sum{
	width: 80px;
	text-align: center;
}

.allsum{
	width: 100px;
	text-align: center;
}

.btn{
	width: 80px;

}
.tmp{
	text-align: center;

}

</style>


<body>


<div class="draggable icon icon1" style="float:left" data-slot1=24 data-slot2=24 data-slot3=24 data-slot4=12>瑞鶴改</div>
<div class="draggable icon icon1" style="float:left" data-slot1=24 data-slot2=24 data-slot3=24 data-slot4=12>翔鶴改</div>
<div class="draggable icon icon1" style="float:left" data-slot1=30 data-slot2=24 data-slot3=24 data-slot4=8>大鳳改</div>
<div class="draggable icon icon1" style="float:left" data-slot1=20 data-slot2=20 data-slot3=46 data-slot4=12>加賀改</div>
<div class="draggable icon icon1" style="float:left" data-slot1=20 data-slot2=20 data-slot3=32 data-slot4=10>赤城改</div>
<div class="draggable icon icon1" style="float:left" data-slot1=18 data-slot2=27 data-slot3=18 data-slot4=10>飛龍改</div>
<div class="draggable icon icon1" style="float:left" data-slot1=18 data-slot2=27 data-slot3=18 data-slot4=10>蒼龍改</div>

<div class="draggable icon icon2" style="float:left" data-slot1=18 data-slot2=28 data-slot3=6 data-slot4=3>龍驤改二</div>


<div class="draggable icon icon3" style="float:left" data-slot1=12 data-slot2=18 data-slot3=18 data-slot4=10>準鷹</div>
<div class="draggable icon icon3" style="float:left" data-slot1=21 data-slot2=21 data-slot3=21 data-slot4=12>瑞鶴</div>
<div class="draggable icon icon3" style="float:left" data-slot1=18 data-slot2=9 data-slot3=3 data-slot4=0>瑞鳳</div>
<div class="draggable icon icon3" style="float:left" data-slot1=0 data-slot2=0 data-slot3=0 data-slot4=0>0化</div>

<div style="clear:both"></div>
<button type=button class="btn btn-default" id="testbutton">テスト</button>


<div id="main_table"></div>

<table border=0 id="test">

	<!-- ################################## 1キャラ目 ################################## -->
	<tr class="c1"> <!-- 1スロット目 -->
		<td class="" rowspan=4><div class="frame droppable">dropped</div></td>  <!-- icon -->
		<td class="slot slot1">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
		<td class="allsum" rowspan=4>0</td><!-- スロット合計 -->
	</tr>


	<tr class="c1"> <!-- 1スロット目 -->
		<td class="slot slot2">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c1"> <!-- 1スロット目 -->
		<td class="slot slot3">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c1"> <!-- 1スロット目 -->
		<td class="slot slot4">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr>
		<td>　</td>
	</tr>



	<!-- ################################## 2キャラ目 ################################## -->
	<tr class="c2"> <!-- 1スロット目 -->
		<td class="" rowspan=4><div class="frame droppable">dropped</div></td>  <!-- icon -->
		<td class="slot slot1">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
		<td class="allsum" rowspan=4>0</td><!-- スロット合計 -->
	</tr>


	<tr class="c2"> <!-- 1スロット目 -->
		<td class="slot slot2">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c2"> <!-- 1スロット目 -->
		<td class="slot slot3">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c2"> <!-- 1スロット目 -->
		<td class="slot slot4">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr>
		<td>　</td>
	</tr>







	<!-- ################################## 3キャラ目 ################################## -->
	<tr class="c3"> <!-- 1スロット目 -->
		<td class="" rowspan=4><div class="frame droppable">dropped</div></td>  <!-- icon -->
		<td class="slot slot1">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
		<td class="allsum" rowspan=4>0</td><!-- スロット合計 -->
	</tr>


	<tr class="c3"> <!-- 1スロット目 -->
		<td class="slot slot2">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c3"> <!-- 1スロット目 -->
		<td class="slot slot3">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c3"> <!-- 1スロット目 -->
		<td class="slot slot4">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr>
		<td>　</td>
	</tr>



	<!-- ################################## 4キャラ目 ################################## -->
	<tr class="c4"> <!-- 1スロット目 -->
		<td class="" rowspan=4><div class="frame droppable">dropped</div></td>  <!-- icon -->
		<td class="slot slot1">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
		<td class="allsum" rowspan=4>0</td><!-- スロット合計 -->
	</tr>


	<tr class="c4"> <!-- 1スロット目 -->
		<td class="slot slot2">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c4"> <!-- 1スロット目 -->
		<td class="slot slot3">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr class="c4"> <!-- 1スロット目 -->
		<td class="slot slot4">0</td><!-- slot -->
		<td class="aircraft">
			<div class="btn-group btn-group-xs">
				<button type="button" class="btn btn-default off" data-value=12>烈風改</button>
				<button type="button" class="btn btn-default off" data-value=10>烈風</button>
				<button type="button" class="btn btn-default off" data-value=9>紫電改二</button>
				<button type="button" class="btn btn-default off" data-value=4>爆戦</button>
			</div>
		</td>
		<td class="sum">0</td><!-- 合計 -->
	</tr>

	<tr>
		<td>　</td>
	</tr>



</table>

<p>合計値</p>
<div id="view_sum"></div>


<p>2-2ボス確保 168</p>

</body>

<!-- js -->
<script type="text/javascript">


// フォームが変更されたとき

// ボタンが押されたとき
$(document).on("click", ".btn", function(data){
	var par = $(this).parent(); // button group
	var par3 = par.parent().parent() // tr
	var btns = par.children();

	// 元のon/off状態
	var is_ON = $(this).hasClass("on");

	// 同じ行の他ボタンをoffにする
	btns.each(function(){
		// 同じ行のbutton
		if( $(this).hasClass("on") ){
			$(this).removeClass("on");
			$(this).addClass("off");
			$(this).removeClass("btn-success");
			$(this).addClass("btn-default");
		}
	});

	// 自分をon/offにする
	if (is_ON){
		$(this).removeClass("on");
		$(this).addClass("off");
		$(this).removeClass("btn-success");
		$(this).addClass("btn-default");
	} else{
		$(this).removeClass("off");
		$(this).addClass("on");
		$(this).removeClass("btn-default");
		$(this).addClass("btn-success");
	}


	// 行slotの計算
	var td_slot = par3.children(".slot");
	var td_sum = par3.children(".sum");

	var ship_value = 0;
	// 現在onなら
	if ($(this).hasClass("on")){
		ship_value = $(this).data("value");
	}

	var num_of_slot = td_slot.html();
	var sum_val = ship_value * Math.sqrt(num_of_slot);
	
	td_sum.html(Math.floor(sum_val));


	// 艦合計の計算
	// 自分の艦のclassを取得
	var my_class = par3.attr('class');
	var my_chara = $("tr." + my_class);

	var chara_sum = 0;
	my_chara.each(function(){
		var my_value = Number($(this).find(".sum").html());
		chara_sum += my_value;
	});

	var output = my_chara.find(".allsum").html(chara_sum);


	// 全体計算
	calculate_all();

});


function table_line(){
	var s = "";
	// argumentsに渡された引数
	for (var i = 0; i < arguments.length; i++){
		 s += '<td>' + arguments[i] + '</td>';
	}
	return s;
}




$(".draggable").draggable({
	
	drop: function(event, ui){
		console.log("aa");
	}

} );

$(".droppable").droppable({
	drop: function(event, ui){
		containment: '.droppable';
		scroll: false;
		greedy: true;
		
		// draggableのslotを取得
		var drop_obj = ui.draggable;
		var slot1 = drop_obj.data("slot1");
		var slot2 = drop_obj.data("slot2");
		var slot3 = drop_obj.data("slot3");
		var slot4 = drop_obj.data("slot4");

		// slotをセット
		// 自分のclassを取得
		var my_class = $(this).closest("tr").attr("class");
		var my_chara = $("tr." + my_class);

		$("tr." + my_class + " .slot1").html(slot1);
		$("tr." + my_class + " .slot2").html(slot2);
		$("tr." + my_class + " .slot3").html(slot3);
		$("tr." + my_class + " .slot4").html(slot4);

		$(this).addClass("dropped");

		console.log(ui.draggable.addClass("drop_" + my_class));

	},
	
	over: function(event, ui){
		// draggableのslotを取得
		var drop_obj = ui.draggable;
		var slot1 = drop_obj.data("slot1");
		var slot2 = drop_obj.data("slot2");
		var slot3 = drop_obj.data("slot3");
		var slot4 = drop_obj.data("slot4");

		// slotをセット
		// 自分のclassを取得
		var my_class = $(this).closest("tr").attr("class");
		var my_chara = $("tr." + my_class);


		// もしすでに値があるなら
		if ( $(this).hasClass("dropped")){
			console.log("dropped確認 on over");
		} else{
			console.log("droppedなし on over");
			$("tr." + my_class + " .slot1").html(slot1);
			$("tr." + my_class + " .slot2").html(slot2);
			$("tr." + my_class + " .slot3").html(slot3);
			$("tr." + my_class + " .slot4").html(slot4);
			$(this).removeClass("dropped");
		}

	},

	out: function(event, ui){
		var my_class = $(this).closest("tr").attr("class");
		var my_chara = $("tr." + my_class);

		
		// もしすでに値があるなら
		if ( $(this).hasClass("dropped")){
			console.log("dropped確認 on out");
		} else{
			console.log("droppedなし on out");
			$("tr." + my_class + " .slot1").html(0);
			$("tr." + my_class + " .slot2").html(0);
			$("tr." + my_class + " .slot3").html(0);
			$("tr." + my_class + " .slot4").html(0);
			$(this).removeClass("dropped");
		}
	}

});


jQuery( function() {
    jQuery( '.draggable' ) . draggable( {
				//helper: "clone",
        snap: '.frame',
        snapTolerance: 30,
				snapmode: 'inner',
				drop: function(event, ui){
					var thisTop= $(this).offsetTop;
					var thisLeft = $(this).offsetLeft;
					var width = $(this).width();
					var height = $(this).height();
					console.log("hoge");
					
					
				},

				stop: function( event, ui ) {
					if( $(this).hasClass("drop_c1")){
						$(this).removeClass("drop_c1");	
					}
				
				}

    } );
} );

// ch番目の艦の制空値合計を出す
function calculate_each(ch){
	var mychara = $("tr." + ch);

	mychara.each(function(){ // 全4つのtr
		console.log("hoge")
		console.log($(this));

	});


	//var mychara_btngrp = mychara.find(".btn-group");

	//var aaa = mychara_btngrp.children();
	//console.log(aaa);


}
	

// 表示されている各艦の制空値の総和を出す（全tr.sumを足すだけ）
function calculate_all(){
	var tmp = $("tr .sum");
	var allsum = 0;
	tmp.each(function(){
		var output = $(this).html();
		allsum += Number($(this).html());
	});
	$("#view_sum").html(allsum);

}

$("#testbutton").click(function(){
	calculate_each("c1");
});



</script>

</html>
